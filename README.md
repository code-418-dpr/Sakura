<img src="https://github.com/user-attachments/assets/46c93a2a-b585-46e0-8b2e-aaa2f8ce47ef" width="10%">

# Sakura

[![license](https://img.shields.io/github/license/code-418-dpr/Sakura)](https://opensource.org/licenses/MIT)
[![release](https://img.shields.io/github/v/release/code-418-dpr/Sakura?include_prereleases)](https://github.com/code-418-dpr/Sakura/releases)

Платформа для организации лотерей, в которых _хочется_ участвовать

## Демо

**Веб-приложение:** https://sakura.code418.ru

Учётные данные (почта и пароль являются одним и тем же значением):

- пользователь: s.scorpi-on@ya.ru

- администратор: anna.petrova@gmail.com

**Админ-панель:** https://db-studio.sakura.code418.ru

Позволяет редактировать таблицы напрямую в базе данных в удобном интерфейсе. В частности регулировать некоторые механики
игры.

**Панель управления обратным прокси:** http://traefik.sakura.code418.ru

Позволяет отслеживать состояние прокси-сервера и управлять им.

<details>
  <summary><h2>Документация</h2></summary>

### Авторизация
Производится по электронной почте и паролю. Поддерживается реферальная программа по промокоду, за которую пригласившему и приглашённому участникам начисляются вознаграждения. В скором времени будет добавлена авторизация по аккаунту Яндекса. 

<img src="https://github.com/user-attachments/assets/188d38be-b3ef-403a-b82d-7fc670252ea5" width="50%">


### Каталог

Позволяет удобно просматривать и искать подходящие лотереи по параметрам.

<img src="https://github.com/user-attachments/assets/89de5ca8-711e-4424-a15c-62584991d021" width="50%">


### Рейтинговая таблица

Помимо баланса средств, пользователь имеет рейтинг, увеличивающийся при активности на платформе. Ежемесячно
пользователи, набравшие больше всего опыта за месяц, будут награждаться. В зависимости от опыта, у пользователя
отображается статус (от новичка, к примеру, до лудомана — это конфигурируется в админ-панели).

<img src="https://github.com/user-attachments/assets/348b92b1-dd8c-4f4b-9e6f-e2ada0f46d91" width="50%">


#### Тамагочи

У каждого пользователя имеется своя Сакура, которая начинает увядать через несколько дней, если в профиле отсутствует
активность (пополнения счёта, покупки билетов и т. д.).

<img src="https://github.com/user-attachments/assets/5c8b0499-545e-4604-9621-73da7a95e254" width="50%">


### Лотереи

- реальные (соответствуют законодательству РФ, призы — деньги или товары);
- виртуальные (не имеют ограничений, призы — бонусная валюта).

Создаются из аккаунта администратора, который может указать тираж билетов, количество всех победителей и суперпризёров,
стоимость билета и т. д. Перед созданием реальной лотереи видит чистую прибыль с неё и при экономической неэффективности
не позволяет её создать.

<img src="https://github.com/user-attachments/assets/da607d62-0e7b-42ba-b724-9fbc6e5e49d1" width="50%">
<img src="https://github.com/user-attachments/assets/7c46f052-bc0f-43de-8088-d201b48025a7" width="50%">



Пользователи могут покупать билеты на лотереи и после их завершения видеть, победили ли они. И если да — то какие призы выиграли.

<img src="https://github.com/user-attachments/assets/dfa3a886-5f7a-4b7a-8e8d-6c79d1e56b2f" width="50%">


#### Игры

Позволяют зарабатывать бонусные баллы или проходить миссии.

#### Морской бой (VIP)
Парная игра, доступная только VIP-пользователям. Если одновременно несколько пользователей решили поиграть, система соединит их в одну партию (в противном случае соперником выступит автомат). Игроки устанавливают одинаковую сумму ставки. Победитель возвращает свою и забирает ставку противника.

<img src="https://github.com/user-attachments/assets/af775dae-38cf-40c9-bc0d-e7b185da6c91" width="50%">

#### Русская рулетка

Начать игру можно лишь за 100 рублей, Вам выдаётся 1 патрон, если вы его выстрелили, то Вам начисляется приз, иначе деньги сгорают. За дополнительную плату даётся возможность зарядить ещё 1 или 2 патрона, чтобы увеличить шансы выйгрыша.

<img src="https://github.com/user-attachments/assets/60d73f9c-1d9f-460f-b42b-54044e9f02dc" width="50%">


#### 5 букв

<img src="https://github.com/user-attachments/assets/ffbbdf49-d3af-408e-8349-446848207d1f" width="50%">

#### Дорожки

<img src="https://github.com/user-attachments/assets/5b892d2e-c201-478f-996e-6b671130427f" width="50%">

#### Бочка

<img src="https://github.com/user-attachments/assets/6eddf377-67c7-4fc3-8a81-a25b3ecf082d" width="50%">

#### Сапёр

<img src="https://github.com/user-attachments/assets/f2ebc5d7-61cc-4749-9301-458acced2691" width="50%">

#### Игровой автомат

<img src="https://github.com/user-attachments/assets/fd4b156a-eb43-48f9-b989-d8bbb9f55963" width="50%">


#### Скретч-карты

<img src="https://github.com/user-attachments/assets/f3923be4-bd6e-430d-8770-5ccba0dcbc5e" width="50%">
<img src="https://github.com/user-attachments/assets/2af2518c-9a48-4705-8ea6-e11e99a792fb" width="50%">

#### Ачивки

Выдаются за выполнение определённых заданий (к примеру, «Азартный игрок» за покупку 5 лепестков в день). В скором времени будут конфигурироваться в админ-панели.

<img src="https://github.com/user-attachments/assets/5c8b0499-545e-4604-9621-73da7a95e254" width="50%">

#### Админ-панель

Изменение параметров возможно на странице [админ-панели](https://db-studio.sakura.code418.ru). Поддерживается, к
примеру, настройка уровней пользователей (UserLevel) и стоимости билетов (Ticket). Планируется расширение возможностей 
кастомизации путём переноса коэффициентов, наценок, скидок и т. д. в БД.

<img src="https://github.com/user-attachments/assets/93cfa4d6-fc37-4b52-9702-fe2db8aa4088" width="50%">

### Лендинг

Отображает маркетинговую информацию о проекте (впоследствии будет актуализирована).

<img src="https://github.com/user-attachments/assets/a91abf57-a78d-40cd-bd51-d5e71fc3d751" width="50%">

</details>

## В планах

- [ ] тематические квесты ко Дню России, Дню защиты детей и т. д.
- [ ] ежедневные миссии из нескольких заданий для получения ачивок
- [ ] кликер на манер Hamster Combat, колесо фортуны и прочие стандартные механики
- [ ] ставки на спорт, больше парных игр
- [ ] внедрение виртуальной реальности (простор для интеграции игр-бродилок, шутеров и т. д.)
- [ ] чат с поддержкой (приоритетной для VIP-пользователей)
- [ ] полноценная админ-панель с отслеживанием статистики, метрик, логов системы
- [ ] система рекомендаций / уведомлений о лотерях и играх

## Архитектура

Проект состоит из микросервисов, предназначенных для развёртывания в Docker Compose:

- **[Веб-приложение](https://github.com/code-418-dpr/Sakura-web)**
- **Prisma Studio** — админ-панель
- **PostgreSQL** — база данных
- **Traefik** — обратный прокси

При необходимости масштабирования новые сервисы легко добавлять и удалять.

Проект развёрнут на VDS и подключён к сетевому домену.

## Стек

- **Bun** — быстрая среда исполнения JavaScript
- **TypeScript** — статически типизированный JavaScript
- **Next.js** — фронтенд-фреймворк на основе React
- **Tailwind CSS** — CSS-фреймворк
- **HeroUI** — набор компонентов
- **Prisma ORM** — ORM для работы с БД
- **Auth.js** — авторизация и управление сессиями
- **ESLint** — статический анализатор кода
- **Stylelint** — анализатор стилей
- **Prettier** — форматировщик кода
- **Docker** — платформа для контейнеризации
- **PostgreSQL** — база данных
- **Traefik** — обратный прокси

## Установка

> [!NOTE]
> Мы отказались от использования `git submodules` и `git subtree` из-за периодически возникающей путаницы при
> отслеживании изменений в монорепозиториях. Данный репозиторий представляет собой единую точку для работы с проектом,
> лишённую этих недостатков.

0. Клонируйте репозиторий и перейдите в его папку.
1. Клонируйте репозитории сервисов, входящих в состав проекта по SSH (рекомендуется):

```shell
git clone git@github.com:code-418-dpr/Sakura-web.git services/Sakura-web
```

или по HTTPS:

```shell
git clone https://github.com/code-418-dpr/Sakura-web.git services/Sakura-web
```

После этого вы можете вносить изменения в каждый из сервисов по-отдельности (в соответствии с инструкциями, описанными в
соответствующих README).

## Запуск и модификация

0. Установите проект по инструкции выше.
1. Создайте файл `.env` на основе [.env.template](.env.template) и задайте все указанные там параметры.
2. Установите Docker.
3. Теперь запускать проект **на сервере** можно командой:

```shell
docker compose --profile server up -d --build
```

При модификации сервисов проекта и их тестировании может потребоваться создание файлов .env для каждого из них. Однако,
при запуске всех сервисов в одном контейнере (из этого репозитория) их не должно быть. Чтобы не удалять их, для запуска
сервисов **на локальном устройстве** можно воспользоваться следующим набором команд:

```shell
mv ./services/Sakura-web/.env ./services/Sakura-web/_.env
docker compose --profile local up -d --build
mv ./services/Sakura-web/_.env ./services/Sakura-web/.env 
```
